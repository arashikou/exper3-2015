"use strict";(function(){var slice=[].slice;angular.module("qbn.choice",["qbn.quality"]).factory("frontalChoices",function(){var api,library,onwards,retreat;return library=[],retreat=void 0,onwards=void 0,api={register:function(choice){return library.push(choice),this},setRetreat:function(choice){return retreat=choice,this},getRetreat:function(){return retreat},setOnwards:function(choice){return onwards=choice,this},getOnwards:function(){return onwards},getAll:function(){return library.filter(function(choice){return choice.isVisible()})}},Object.freeze(api)}).factory("choiceFactory",function(qualities){var Choice,validateReqs;return validateReqs=function(reqs){var chattyPredicate,quality,qualityName,validations;return validations=function(){var results;results=[];for(qualityName in reqs)chattyPredicate=reqs[qualityName],quality=qualities.lookup(qualityName),results.push(chattyPredicate(quality));return results}(),validations.filter(function(v){return v!==!0})},Choice=function(){function Choice(id,title,text,visibleReqs,activeReqs,next){this.id=id,this.title=title,this.text=text,this.visibleReqs=visibleReqs,this.activeReqs=activeReqs,this.next=next,Object.freeze(this)}return Choice.prototype.isVisible=function(){return 0===validateReqs(this.visibleReqs).length},Choice.prototype.isActive=function(){return 0===this.unsatisfiedActiveReqs().length},Choice.prototype.unsatisfiedActiveReqs=function(){return validateReqs(this.activeReqs)},Choice}(),function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Choice,args,function(){})}})}).call(this),function(){angular.module("qbn.edsl",["qbn.quality","qbn.storylet","qbn.choice","qbn.engine"]).factory("qbnEdsl",function(qualities,storylets,frontalChoices,choiceFactory,startingPoint){var api;return api={qualityType:Object.freeze({stat:function(){return this.name+" is "+this.value},item:function(){return this.value+" x "+this.name},unique:function(){return"You have "+this.name},string:function(){return"You are "+this.value}}),quality:function(id,type,name,description,args){var escalation,hasProgress,maxProgress,progress,value,visible;null==args&&(args={}),value=args.value,progress=args.progress,maxProgress=args.maxProgress,hasProgress=args.hasProgress,escalation=args.escalation,visible=args.visible,null==value&&(value=0),null==progress&&(progress=0),null==maxProgress&&(maxProgress=hasProgress?100:0),null==escalation&&(escalation=.1),null==visible&&(visible=!0),qualities.register(id,name,type,description,value,progress,maxProgress,escalation,visible)},storylet:function(id,title,text,args){var choices,consequences;null==args&&(args={}),choices=args.choices,consequences=args.consequences,null==choices&&(choices=[]),null==consequences&&(consequences={}),storylets.register(id,title,text,choices,consequences)},start:function(storylet){startingPoint.set(storylet)},consq:Object.freeze({increase:function(amount){return function(quality){var changedBy;return changedBy=quality.increase(amount),null==changedBy?"**"+quality.name+"** increased by **"+amount+"**.":0===changedBy?"**"+quality.name+"** progressed by **"+amount+"**. Only **"+(quality.maxProgress-quality.progress)+"** to go!":"**"+quality.name+"** progressed by **"+amount+"**, increasing it to **"+quality.value+"**! Only **"+(quality.maxProgress-quality.progress)+"** to go."}},decrease:function(amount){return function(quality){var changedBy;return changedBy=quality.increase(-amount),null==changedBy?"**"+quality.name+"** decreased by **"+amount+"**.":0===changedBy?"**"+quality.name+"** regressed by **"+amount+"**. Now there's **"+(quality.maxProgress-quality.progress)+"** to go!":"**"+quality.name+"** regressed by **"+amount+"**, reducing it to **"+quality.value+"**! Now there's **"+(quality.maxProgress-quality.progress)+"** to go."}},set:function(value){return function(quality){return quality.value=value,"**"+quality.name+'** is now "**'+value+'**."'}}}),choice:function(id,title,text,args){var active,next,visible;return null==args&&(args={}),next=args.next,visible=args.visible,active=args.active,null==next&&(next=id),null==visible&&(visible={}),null==active&&(active={}),choiceFactory(id,title,text,visible,active,next)},front:function(choice){frontalChoices.register(choice)},retreat:function(choice){frontalChoices.setRetreat(choice)},onwards:function(choice){frontalChoices.setOnwards(choice)},reqs:Object.freeze({gt:function(req){return function(quality){return quality.value>req||"Requires **"+quality.name+"** greater than **"+req+"**. You have **"+quality.value+"**."}},gte:function(req){return function(quality){return quality.value>=req||"Requires **"+quality.name+"** at least **"+req+"**. You have **"+quality.value+"**."}},lt:function(req){return function(quality){return quality.value<req||"Requires **"+quality.name+"** less than **"+req+"**. You have **"+quality.value+"**."}},lte:function(req){return function(quality){return quality.value<=req||"Requires **"+quality.name+"** no more than **"+req+"**. You have **"+quality.value+"**."}},range:function(low,high){return function(quality){var ref;return low<(ref=quality.value)&&high>ref||"Requires **"+quality.name+"** between **"+low+"** and **"+high+"**. You have **"+quality.value+"**."}},eq:function(value){return function(quality){return quality.value===value||"Requires **"+quality.name+"** of **"+value+"**, but you have **"+quality.value+"**."}},exists:function(quality){return quality.value?!0:"Requires **"+quality.name+"**, which you do not have."},notexists:function(quality){return quality.value?"Forbidden by **"+quality.name+"**, which you have.":!0}})},Object.freeze(api)})}.call(this),function(){angular.module("qbn.engine",["qbn.quality","qbn.storylet","qbn.choice","qbn.save","qbn.resolve"]).factory("startingPoint",function(){var api,startingStorylet;return startingStorylet=void 0,api={set:function(value){return startingStorylet=value},get:function(){return startingStorylet}},Object.freeze(api)}).controller("QbnEngine",function($scope,startingPoint,qualities,storylets,frontalChoices,savedGame,resolveFilter){var addDefaultsToChoices,isFrontal,loaded,storyletName,updateFrontalValues;updateFrontalValues=function(){$scope.qualities=qualities.getAll(),$scope.choices=frontalChoices.getAll()},addDefaultsToChoices=function(storylet){storylet.isFrontal&&(storylet.choices=storylet.choices.concat(frontalChoices.getRetreat())),storylet.choices.length>0||(storylet.choices=[frontalChoices.getOnwards()])},loaded=savedGame.load(),null!=loaded?(storyletName=loaded[0],isFrontal=loaded[1],$scope.storylet=storylets.lookup(storyletName),null!=$scope.storylet&&($scope.storylet.isFrontal=isFrontal,addDefaultsToChoices($scope.storylet))):$scope.storylet=storylets.lookup(startingPoint.get()),updateFrontalValues(),$scope.choose=function(choice){var next,storylet;next=resolveFilter(choice.next),storylet=storylets.lookup(next),null!=storylet?(storylet.performConsequences(),storylet.isFrontal=null==$scope.storylet,addDefaultsToChoices(storylet)):updateFrontalValues(),$scope.storylet=storylet,savedGame.save(null!=storylet?storylet.id:void 0,null!=storylet?storylet.isFrontal:void 0)},$scope.resetSave=function(){confirm("This will erase all your progress and start you over from the beginning. Are you sure?")&&(savedGame.erase(),location.reload())}}).directive("choiceList",function(){return{templateUrl:"choiceList",restrict:"E",scope:{choices:"=",choose:"="}}})}.call(this),function(){angular.module("qbn",["ngSanitize","qbn.engine","markdown","gameDefinition"])}.call(this),function(){var converter;converter=new window.showdown.Converter({strikethrough:!0}),angular.module("markdown",[]).filter("markdown",function(){return function(input){return converter.makeHtml(null!=input?input:"")}})}.call(this),function(){var Quality,slice=[].slice;Quality=function(){function Quality(id,name,format,description,defaultValue,defaultProgress,defaultMaxProgress,progressEscalation,visible){this.id=id,this.name=name,this.format=format,this.description=description,this.defaultValue=defaultValue,this.defaultProgress=defaultProgress,this.defaultMaxProgress=defaultMaxProgress,this.progressEscalation=progressEscalation,this.visible=visible,Object.freeze(this)}return Quality.prototype.increase=function(amount){var counter,down,i,level,ref,up;if(up=1,down=-1,level=function(_this){return function(direction){_this.value+=direction,_this.maxProgress=direction===up?_this.maxProgress*(1+_this.progressEscalation):_this.maxProgress/(1+_this.progressEscalation)}}(this),0!==this.maxProgress){for(counter=0,this.progress+=amount;this.progress>this.maxProgress;)this.progress-=this.maxProgress,level(up),counter++;for(;this.progress<0;)level(down),this.progress+=this.maxProgress,counter++;return counter}for(i=0,ref=amount;ref>=0?ref>i:i>ref;ref>=0?i++:i--)level(amount>=0?up:down)},Quality.prototype.save=function(){return{id:this.id,value:this.value,progress:this.progress,maxProgress:this.maxProgress}},Quality.prototype.load=function(saved){return this.value=saved.value,this.progress=saved.progress,this.maxProgress=saved.maxProgress},Quality}(),angular.module("qbn.quality",["qbn.state"]).factory("qualities",function(makeGameState){var api,library;return library={},window.qualities=library,api={register:function(){var args,quality;return args=1<=arguments.length?slice.call(arguments,0):[],quality=function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Quality,args,function(){}),library[quality.id]=makeGameState(quality),this},lookup:function(q){return q instanceof Quality?q:library[null!=q?q.toString():void 0]},getAll:function(){var _,quality,results;results=[];for(_ in library)quality=library[_],quality.visible&&quality.value&&results.push(quality);return results},saveAll:function(){var _,quality,results;results=[];for(_ in library)quality=library[_],results.push(quality.save());return results}},Object.freeze(api)})}.call(this),function(){angular.module("qbn.resolve",["qbn.quality"]).filter("resolve",function($injector,qualities){return function(v){for(var qualityNames,qualityValues;"function"==typeof v||Array.isArray(v);)qualityNames=$injector.annotate(v),qualityValues=qualityNames.map(function(name){var ref;return null!=(ref=qualities.lookup(name))?ref.value:void 0}),v=v.apply(null,qualityValues);return v}})}.call(this),function(){angular.module("qbn.save",["qbn.quality"]).factory("savedGame",function(qualities){var api,storageName;return storageName="qbnSave",api={load:function(){var i,len,quality,ref,ref1,ref2,save,savedQuality;if(save=JSON.parse(localStorage.getItem(storageName)),null==save)return void 0;for(ref=save.qualities,i=0,len=ref.length;len>i;i++)savedQuality=ref[i],quality=qualities.lookup(savedQuality.id),quality.load(savedQuality);return[null!=(ref1=save.storylet)?ref1.id:void 0,null!=(ref2=save.storylet)?ref2.isFrontal:void 0]},save:function(storylet,isFrontal){var save;save={qualities:qualities.saveAll()},null!=storylet&&(save.storylet={id:storylet,isFrontal:isFrontal}),localStorage.setItem(storageName,JSON.stringify(save))},erase:function(){localStorage.clear()}},Object.freeze(api)}),window.emergencySaveClear=function(){return localStorage.clear()}}.call(this),function(){angular.module("qbn.state",[]).factory("makeGameState",function(){return function(proto){var _,first,instance,key,newName,ref,rest,value;instance=Object.create(proto);for(key in proto)value=proto[key],/^default\w/.test(key)&&(ref=/^default(\w)(\w*)/.exec(key),_=ref[0],first=ref[1],rest=ref[2],newName=first.toLowerCase()+rest,instance[newName]=value);return instance}})}.call(this),function(){var slice=[].slice;angular.module("qbn.storylet",["qbn.state","qbn.quality"]).factory("storylets",function(makeGameState,qualities){var Storylet,api,library;return Storylet=function(){function Storylet(id,title,text,defaultChoices,consequences){this.id=id,this.title=title,this.text=text,this.defaultChoices=defaultChoices,this.consequences=consequences,Object.freeze(this)}return Storylet.prototype.performConsequences=function(){var performer,quality,qualityName,report,reports;return reports=function(){var ref,results;ref=this.consequences,results=[];for(qualityName in ref)performer=ref[qualityName],quality=qualities.lookup(qualityName),report=performer(quality),results.push(quality.visible?report:void 0);return results}.call(this),this.consequenceReports=reports.filter(function(x){return null!=x})},Storylet}(),library={},api={register:function(){var args,storylet;return args=1<=arguments.length?slice.call(arguments,0):[],storylet=function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Storylet,args,function(){}),library[storylet.id]=storylet,this},lookup:function(q){var storylet;return q instanceof Storylet?q:(storylet=library[null!=q?q.toString():void 0],null!=storylet?makeGameState(storylet):void 0)}},Object.freeze(api)})}.call(this),function(){angular.module("gameDefinition.clientStories",["qbn.edsl"]).run(function(qbnEdsl){var choice,consq,reqs,setBothered,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,storylet("botherClient","Visit the client","Mrs. Brown is at home when you arrive. A servant offers to fetch her. Are you here to see her\nor to investigate the crime scene?",{choices:[choice("solveEvidence","Solve the case with evidence","But if this… Then that… Which means…",{active:{evidence:reqs.gte(4)},next:"solve1"}),choice("solveHunch","Solve the case with pure gumption","Something about this situation doesn't seem right. Damn collecting evidence; with enough\nhunches, you could blow this case wide open!",{active:{illusionHunch:reqs.gte(2),hallucinationHunch:reqs.gte(2),hypnotismHunch:reqs.gte(3)},next:"solve1"}),choice("advanceAsk","Ask for an advance","This case is taking a while, and the retainer's running thin. It's time to hit up the\nclient for more money.",{visible:{day:reqs.gte(3),advance:reqs.notexists}}),choice("askClient1","Ask for more info","You feel like maybe there's something she hasn't told you yet.",{visible:{jackie:reqs.lte(0)}}),choice("askClient2","Ask what's wrong","When you arrive, the sound of Mrs. Brown's sobbing fills the house. Something is\ndefinitely up.",{visible:{day:reqs.gte(5),roxy:reqs.lte(0)}}),choice("crimeScene","Inspect the crime scene","There are bound to be clues the police's half-hearted investigation missed.")]}),setBothered=function(bothered){return bothered.value=!0,"Mrs. Brown does not wish to see you again today."},storylet("advanceAsk","Ask for an advance","Mrs. Brown is a little less free with her funds this time. Perhaps she expected the case to\nbe resolved by now, in which case she's a fool. Or perhaps she showed the contract to one of\nher accountants, in which case she's less-so. Nonetheless, you are able to draw a little blood\nfrom the stone before being sent on your way with a reminder to earn that money.",{consequences:{bluebacks:consq.increase(6),bother:setBothered,advance:function(quality){return quality.value=!0,"You will not be able to ask for an advance again."}}}),storylet("askClient1","Ask for more info","\"Actually, there is something new,\" she purrs. \"While I was going through Horry's old things,\nI came across this receipt.\"\n\nShe hands you a receipt almost identical to the one you made out for her in your office.\n\n\"It seems I wasn't the first one to employ a private detective. Though what he hired this\n'Jackie' for, I couldn't say.\"\n\nYou know Jackie. He's one of the old guard. He was in this business before the war, before\nmagic. Hell, maybe before you were even born. The new world hasn't been kind to him, though,\nand word is he fell on hard times recently. Maybe hard enough to get him to parley with the\ncompetition? It's not much, but it's a start.",{consequences:{jackie:function(quality){return quality.value++,"You have received a receipt from Mrs. Brown."},bother:setBothered}}),storylet("askClient2","Ask what's wrong","\"Oh, it's horrible! You just missed them! Two thugs were here, making threats! Warning\nme to stop the investigation! Telling me to leave town!\"\n\nAfter you calm Mrs. Brown down, you get a description of the thugs. The purple carnation\nlapel pins make them\neasy to identify. These boys belonged to Roxy Malone, one of the three biggest gangsters in\nthe city. What Roxy's stake in this is, you have no idea, but you aim to ask her.\n\nYou make a point of not asking if Mrs. Brown wants the investigation called off, and she\ndoesn't make a point of telling you. This one is too juicy to let slip away.",{consequences:{roxy:function(quality){return quality.value++,"You have received a description of some thugs from Mrs. Brown."},bother:setBothered}}),storylet("crimeScene","Inspect the crime scene","Mrs. Brown has a servant let you into the witching parlor. She can't bear to look at it\nherself. What are you looking for?",{choices:[choice("crimeSceneIllusion","Evidence of illusions"),choice("crimeSceneHallucination","Evidence of hallucinations"),choice("crimeSceneHypnotism","Evidence of hypnotisms"),choice("crimeSceneRumor","Information in Horace Brown's files"),choice("crimeSceneDrink","Actually, I'm here to raid the liquor cabinet"),choice("leaveUntouched","Leave the crime scene untouched","On second thought, maybe coming here was a bad idea.",{next:!1})]}),storylet("crimeSceneIllusion","Evidence of illusions","Someone on the house staff has been using illusions to hide subpar housework. It's amateur\nstuff, but it confounds your search. Nonetheless, there has definitely been a more\ncompetent illusionist\nat work here as well. But was it Brown or someone else?",{consequences:{illusionHunch:consq.increase(1),bother:setBothered}}),storylet("crimeSceneHallucination","Evidence of hallucinations","If there were any hallucinations here, they've been cleaned up. But sometimes a hallucination\nis telling by its absence. There are three suspicious gaps in the decor on the wall opposite\nthe windows. By the looks of it, there were hallucinations here for quite some time; the\nstaff had been cleaning around them. Were they Brown's work? Or somehow related to his\ndisappearance?",{consequences:{hallucinationHunch:consq.increase(1),bother:setBothered}}),storylet("crimeSceneHypnotism","Evidence of hypnotisms","Your brain is on fire. Here, by the workbench. Judging by the height, the person was in the\nprocess of standing up. And over here, by the window. But this one, it was a different person\nthan the first…",{consequences:{hypnotismHunch:consq.increase(1),bother:setBothered}}),storylet("crimeSceneRumor","Information in Horace Brown's files","You don't turn up any evidence relevant to the case, but you do turn up some juicy tidbits\nthat you're pretty sure aren't public knowledge.",{consequences:{rumor:consq.increase(3),bother:setBothered}}),storylet("crimeSceneDrink","Raiding the liquor cabinet","Alas, the liquor has been removed, perhaps against just such an eventuality. But you are\nable to snag a few Cantrip-Ups that you don't imagine will be missed.",{consequences:{cantripUp:consq.increase(3),bother:setBothered}})})}.call(this),function(){angular.module("gameDefinition.copStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("copStart","A crooked cop",'Dentley thumbs the stack of bills to make sure you aren\'t shorting him. "Horace Brown, eh?\nFunny you should mention him. That name just came across my desk this morning."\n\nYou ask whether this means the police are going to investigate the disappearance after all.\n\n"No, no, nothing like that. His _alleged_ disappearance…" Something gives even Dentley pause.\n"That investigation is being shut down from a very high level. No, he came up as a person of\ninterest in another case. Of course, as no one can find him, that\'s a request I am putting\nno effort into fulfilling."\n\n"There was a body. Washed up on the south banks near the granary district. It also vanished\nbefore we could bring it in. I don\'t know any more than that, but someone thinks it\'s tied to\nBrown, somehow, so it\'s probably of interest to you."',{consequences:{bluebacks:consq.decrease(10),lead:consq.set(leads.cop),cop:function(quality){return quality.value++,"Officer Dentley has given you a tip about a body."},progress:consq.set(0)}}),storylet("cop1","Follow up on Dentley's tip","You need to find this body before the police do.",{choices:[choice("cop1Rumor","Connect the dots","Some of these rumors you're hearing must be about the body.",{visible:{progress:reqs.lt(7)},active:{rumor:reqs.gte(3)}}),choice("cop1Bluebacks","Pay for info","Unlike the police, you're willing to pay for good info.",{visible:{progress:reqs.lt(7)},active:{bluebacks:reqs.gte(3)}}),choice("cop1CantripUp","Hire a scryer","Magic is the modern way, after all.",{visible:{progress:reqs.lt(7)},active:{cantripUp:reqs.gte(3)}}),choice("cop1Solve","Somebody has been found","You know where the body went. You can only hope there's enough left to ID.",{active:{progress:reqs.gte(7)}})]}),storylet("cop1Rumor","Connect the dots","With your info, you are able to narrow down the locations the body could have gone to.",{consequences:{rumor:consq.decrease(3),progress:consq.increase(1)}}),storylet("cop1Bluebacks","Pay for info","You find a few people who saw the body before it was moved or saw it being moved. Whoever it\nwas has them too scared to name names, but you can feel your net closing.",{consequences:{bluebacks:consq.decrease(3),progress:consq.increase(1)}}),storylet("cop1CantripUp","Hire a scryer","You can't afford a top-rate scryer, but the one you _can_ afford gives your some tantalizing\nand useful clues about the body's current disposition.",{consequences:{cantripUp:consq.decrease(3),progress:consq.increase(1)}}),storylet("cop1Solve","Not much left","You burst into the warehouse and order everyone on the floor. Like terrified lambs, they all\ncomply. Despite their sick tendencies, these men and women aren't savage or prepared to\ndefend themselves. They're lucky you found them and their crime first; the police might\nhave come in with guns blazing.\n\nThey're \"ghouls,\" or at least that's how they fancy themselves. People who think this era of\ncasual magic gives them the right to appropriate old cultural traditions and use them as a\ncover for their twisted desires.\n\nYou gather what's left of the body in a sack and warn them to get lost before the police\narrive. You make haste to the precinct before the body starts to smell, but not before taking\na peek for yourself.\n\nThere's not much left, but what's there is confusing. The body is female, unqestionably.\nThere are bits of clothing from a dress similar to the one\nMrs. Brown was wearing the day she walked into your office. Also a broach that's identical\nto one you've seen at the Brown household. And judging by the time of its discovery and its\nstate at the time, this person probably died within a day before or after Mr. Brown\ndisappearing. There's no hope of identifying this person now, but\nthis is definitely tied to your case somehow.",{consequences:{evidence:consq.increase(2),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},cop:function(quality){return quality.value++,"You found a body, or at least what's left of it."},progress:consq.set(0)}})})}.call(this),function(){angular.module("gameDefinition.dealerStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,dealerBlather,dealerSealed,escapeChoice,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("clubDealer","A dealer in rarities","You can't even open your mouth before the rarities dealer recognizes you for what you are.\n\"How the hell did you even get in here, you burnout!? Where's security?\"\n\nBefore he can summon anyone, you slam the demon cage down on the table. It shuts him right\nup. At his quizzical stare, you produce the demon's papers. He looks them over, then looks\nthem over again, unable to believe that someone as mundane as yourself could get your\nhands on such an esoteric item.\n\nFinally, he grunts his assent. \"I'll concede, you are something special. I don't have any use\nfor it, but I'll put it up for sale. If anyone wants the little bastard, you get 50% after\ntaxes.\nAnd if you're interested in making any other trades, why not come by my shop later yourself?\"\nHe produces a card with an address and a password.",{consequences:{cagedDemon:consq.decrease(1),dealer:consq.set(1)}}),storylet("dealerFront","A dealer in rarities",'Despite your having earned enough of his respect to get into his shop, the dealer still fixes\nyou with a wary glare.\n\n"Well, go on. What is it you want?"',{choices:[choice("dealerRibbon","Trade an inscribed ribbon",void 0,{active:{inscribedRibbon:reqs.gte(1)}}),choice("dealerSealbone","Trade a sealbone trinket",void 0,{active:{sealboneTrinket:reqs.gte(1)}}),choice("dealerCarnelian","Trade a veiny carnelian",void 0,{active:{veinyCarnelian:reqs.gte(1)}})]}),escapeChoice=choice("dealerEscape","On second though, maybe not…","_Return to the main screen._"),dealerBlather='"Oh? And what do you want for it?"',dealerSealed='"Very well, I accept! And any time you want to trade again, you know where to find me!"',storylet("dealerRibbon","Trade an inscribed ribbon",dealerBlather,{choices:[choice("dealerRibbonForSealbone","Trade for a sealbone trinket","This trinket will help you detect hallucinations."),choice("dealerRibbonForCarnelian","Trade for a veiny carnelian","This gem will help you detect hypnotisms."),escapeChoice]}),storylet("dealerRibbonForSealbone","Trade ribbon for sealbone",dealerSealed,{consequences:{inscribedRibbon:consq.decrease(1),sealboneTrinket:consq.increase(1)}}),storylet("dealerRibbonForCarnelian","Trade ribbon for carnelian",dealerSealed,{consequences:{inscribedRibbon:consq.decrease(1),veinyCarnelian:consq.increase(1)}}),storylet("dealerSealbone","Trade a sealbone trinket",dealerBlather,{choices:[choice("dealerSealboneForRibbon","Trade for an inscribed ribbon","This ribbon will help you detect illusions."),choice("dealerSealboneForCarnelian","Trade for a veiny carnelian","This gem will help you detect hypnotisms."),escapeChoice]}),storylet("dealerSealboneForRibbon","Trade sealbone for ribbon",dealerSealed,{consequences:{sealboneTrinket:consq.decrease(1),inscribedRibbon:consq.increase(1)}}),storylet("dealerSealboneForCarnelian","Trade sealbone for carnelian",dealerSealed,{consequences:{sealboneTrinket:consq.decrease(1),veinyCarnelian:consq.increase(1)}}),storylet("dealerCarnelian","Trade a veiny carnelian",dealerBlather,{choices:[choice("dealerCarnelianForRibbon","Trade for an inscribed ribbon","This ribbon will help you detect illusions."),choice("dealerCarnelianForSealbone","Trade for a sealbone trinket","This trinket will help you detect hallucinations."),escapeChoice]}),storylet("dealerCarnelianForRibbon","Trade carnelian for ribbon",dealerSealed,{consequences:{veinyCarnelian:consq.decrease(1),inscribedRibbon:consq.increase(1)}}),storylet("dealerCarnelianForSealbone","Trade carnelian for sealbone",dealerSealed,{consequences:{veinyCarnelian:consq.decrease(1),sealboneTrinket:consq.increase(1)}})})}.call(this),function(){angular.module("gameDefinition.employerStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("employerStart","Mr. Brown's last employer",'Getting an appointment isn\'t hard. The hard part is getting an appointment with anyone that\nmatters. The clerk that sits across from you is full of platitudes and dry on promises or\ninformation. It\'s only when you start letting the word on the street slip, when you start\ntalking about Mr. Horace Brown and the things Kimble, Battherwhite, and Smith have been\nrumored to have hired him for that the clerk begins to sweat.\n\nHe is about start on his third\nand shakiest round of not commenting on rumors when the door opens. Poor guy. He did\nbetter than most would have. You hope the higher-ups are lenient with him.\n\nThat your conversation was being seceretly surveiled is no surprise. The clerk\nis relieved and sent on his way by a man in a sharp suit. You hope that he can prove more\nuseful than his predecessor.\n\nHe sizes you up for a moment. "OK, you\'ll do." He sits at the table where the clerk had been\nbefore. "James, you can stop listening in now. In fact, cancel all\nsurveilance of this room."\n\nHe regards you for a moment before speaking. "I know who you are, and I know who you work for,\nand I would usually be sent down here to tell you that we have nothing to do with any of it\nand kick you on your merry way. However…" He coughs. "Mr. Brown left a great deal of very\nimportant work undone before he disappeared. We here at Kimble, Battherwhite, and Smith have\ntired of waiting for him to return and are prepared to recontract out that work."\n\n"Problem is, we do not have a ready pool of sufficiently mystical candidates. And time is of\nthe essence. Whereas you have connections in magical society and know many of the players\nthere, but you need something we have.\nSo here\'s what we are willing to do: You find us replacements for Mr. Brown and\nwe will be willing to share our info on what he was doing here."\n\nHe scoots a folder across the table at you. "We\'ll need people with all these specialties,\nand they _must_ be used to working together. We don\'t have time for hellos and tea and cakes."\n\nYou glance over the list. A snake charmer? A hypnotist with an ML3 license? A\ntransmutationist of foreign citizenship? What could they possibly need all these for?',{consequences:{rumor:consq.decrease(10),lead:consq.set(leads.employer),kbs:function(quality){return quality.value++,"Kimble, Battherwhite, and Smith have employed you as a headhunter."},progress:consq.set(0)}}),storylet("employer1","Headhunt for KB&S","You know better than to ask what Kimble, Battherwhite, and Smith want with these very\nspecific people, but everything you can imagine fills you with dread. Better get this over\nwith.",{choices:[choice("employer1CantripUp","Buy a round of drinks","Being liberal with Cantrip-Up always brings people running.",{visible:{progress:reqs.lt(7)},active:{cantripUp:reqs.gte(3)}}),choice("employer1Hunch","Use your hunches","They want a hypnotist. Since you have hypnotism hunches, maybe that's the lead to\nstart with.",{visible:{progress:reqs.lt(7)},active:{hypnotismHunch:reqs.gte(1)}}),choice("employer1Solve","Aha!","You've actually found what they're looking for!",{active:{progress:reqs.gte(7)}})]}),storylet("employer1CantripUp","Buy a round of drinks","You meet many interesting people working the crowd. Some seem like they have potential. Others\nare more than happy to talk about their friends and acquaintances.",{consequences:{cantripUp:consq.decrease(3),progress:consq.increase(1)}}),storylet("employer1Hunch","Use your hunches","You find several hypnotists operating further outside the public eye. A strange fellow in\nthe university district. The man above the butcher shop. A lady stowing away in the back of\nthe mail truck unnoticed.",{consequences:{hypnotismHunch:consq.decrease(1),progress:consq.increase(1)}}),storylet("employer1Solve","A most eclectic crew","Against all odds, a group like the one Kimble, Battherwhite, and Smith wants actually exists.\nThough they primarily make their living as musicians now, they all have magical backgrounds\nthat match KB&S's needs. And, more importantly, they are keen to make some money putting those\ntalents to work. \"Beats singing another night for tips at The Red Squirrel.\"\n\nThe man in the sharp suit is pleased. As the troupe is ushered away to Contractor Orientation,\nhe turns back to you. \"And don't think I've forgotten your payment. Let me tell you exactly\nwhat they'll be doing.\"\n\nYou learn less of use than you'd hoped, and several things you wish perhaps you had never\nknown. About ancient religions given new\nrelevance in this magical age. About a grand ceremony in the planning. Mr. Brown was not\nactually working for KB&S, _per se_. Rather, he had been employed by Battherwhite, Esq.\nherself to prepare an elaborate ritual basement. You're quite sure she's completely mad, but\nas the sharp-suited man reminds you as he steers you towards the exit, \"As you can see, Mr.\nBrown's disappearance puts us at rather a disadvantage, so we couldn't possibly have been\ninvolved. It's been a great burden on us, until you came along.\"\n\nAs consolation, he presses a small gemstone on you. \"We have dozens, and I think\nsomeone in your line of work will find it eminently useful.\"",{
consequences:{evidence:consq.increase(1),veinyCarnelian:consq.increase(1),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},kbs:function(quality){return quality.value++,"Kimble, Battherwhite, and Smith no longer require your services."},progress:consq.set(0)}})})}.call(this),function(){angular.module("gameDefinition.endingStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,epilogue,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("solve1","A cold day","Your hand hesitates, just a moment, before knocking on Mrs. Brown's door. You have the answers\nshe wanted, but is this really going\nto make her life any better? What does justice even mean in a situation like this one? To\nwalk away and leave the case unsolved might be the kindest thing for all involved and the\nclosest thing to justice that could come from this.\n\nBut you don't get paid to make those kinds of calls. You get paid to deliver information. And\nthat's what you're here to do, at long last, for Mrs. Brown. This isn't the first time the\nnews hasn't been what your client was hoping for. It may be a situation that's unique in your\nexperience — and likely anyone else's — but it's no different in that way than breaking the\nnews to someone that their spouse is a cheating bastard or that their loved one's current\naddress is in the city morgue.\n\nYou turn and glance at your companions. One is a wizard friend from the old days. You'll owe\nhim a favor for this, and you're not looking forward to repaying it. The other\nis an ex-boxer that owes _you_ a favor for helping him clear his name and reputation a few\nyears ago. Both are going to be essential to surviving today.",{choices:[choice("solve2","Knock and get this over with")]}),storylet("solve2","A sharp knock",'You are promptly admitted. Your companions draw a few raised eyebrows, but you insist that\nthey are vital to your\ninvestigation. You also insist on meeting Mrs. Brown at the scene of the crime. It\'s dramatic,\nperhaps, but not half as dramatic as what you\'re here to do.\n\nOnce you\'ve been left alone with Mrs. Brown, you regard her for a long moment. The illusion is\nalmost perfection. Whoever created her knew Mrs. Brown better than anyone in this world. And\nthe wards in place to dissuade magical detection are advanced sorcery of the highest caliber.\nThis is the work of a master, no doubt about it, and a master with intimate knowledge of\nMrs. Brown. To anyone not in posession of your particular talents and knowledge, it would be\nimpossible to tell.\n\n"Why— Why are you staring at me?" she stammers.\n\nYou don\'t answer. Instead, you inform her that you have found Mr. Brown.\nYou explain that her husband is, in fact, not dead. This\nnews heartens her, to your dismay.\n\n"Where is he, then?!?" she gasps. "Has he been kidnapped? Is he— is he hiding?"',{choices:[choice("solve3",'"Bring him out, Jim."')]}),storylet("solve3","A man revealed","Your wizard friend begins to weave his work. There is a feeling like an oncoming storm, of the\npressure in the room dropping. He's lowered the ambient warpweave levels in order to isolate\nthe illusions at play.\n\nAnd then, all at once, the illusion breaks. Mrs. Brown is like so much water, dumped out of\na dirty bucket. She washes away onto the floor, leaving behind a confused, weak-kneed,\nmustachioed man in a fawn suit.\n\n\"What? What the devil? Where am—\"\n\nYou don't give him time to finish.",{choices:[choice("solve4",'"Now! Pin him!"')]}),storylet("solve4","A man revealed","The boxer is on him in a moment. He's up against the wall before he has time to recover his\nsenses. The wizard continues to keep the warpweave out, in hopes of denying him access to\nmagic. You breathe a sigh of relief. Exposing Mr. Horace Brown was easy enough, but locking\nhim down before he could escape was a risk.\n\nIt wasn't Mr. Brown that disappeared that night. It was Mrs. Abigail Brown. You never actually\nmet her because she was already dead before you got involved.\n\nShe'd been cheating on Mr.\nBrown. With evidence of her infidelity in hand, Horace had confronted her. There'd been a\nfight. A fight that got physical. A fight that got magical.\nAnd at a clear disadvantage in that situation, Abigail Brown had died, and her body had ended\nup in the river. Mr. Brown used his connections to shush the police from investigating.\nAnd that might have been the end of\nit, if not for the intervention of a third party.\n\nA third party that thinks you don't know she's creeping in the window behind you.",{choices:[choice("solve5",'"Hello, Roxy."')]}),storylet("solve5","A woman revealed","You hear the click of a revolver cocking from behind you.\n\n\"Dis. I can't believe you were really fool enough to undo it. To bring that monster back into\nthis world. What the hell do you think you're doing?!?\"\n\nAh, Roxy. Roxy the gangster. Roxy the sorceress. As you suspected, she was Mrs. Brown's\nlover. She found Mr. Brown with the body and transformed him into the simulacrum that has been\nliving as Mrs. Brown for the last few weeks. The one that hired you to look for the missing\nhusband that was right under her nose the whole time.",{choices:[choice("solve6",'"Why did you do it, Roxy?"')]}),storylet("solve6","A fate resolved","\"Why?!? Because he took something beautiful and wonderful away! Because she\ndeserved to be in this world and he didn't anymore! So I made him disappear and tried to bring\nher back. I made him into her, body and mind. But—\" There's a frustrated growl.\n\"It wasn't enough. It wasn't the same. I couldn't forget who was\nunderneath her skin. It was torture to be around him. But I couldn't bring myself to undo the\nillusion; it would be like killing her all over again myself.\nSo I erased myself from her memory and\ntried to scare her out of town. Out of sight, and someday out of mind.\n\n\"Surely you understand, Dis.\nJust as I'm sure you know you can't just take him to the police now. He's got them in his\npocket. And a master sorcerer like him? Even if they convicted him, they'd never\nhold him.\"\n\nShe steps where you can see her and levels her gun at Mr. Brown. \"The only way to ensure that\nAbigail gets justice is to end him myself.\"",{choices:[choice("solve7-roxy","Let Roxy shoot him"),choice("solve7-nobody","Stop Roxy"),choice("solve7-dis","Shoot him yourself")]}),epilogue=choice("epilogue","And so the story ends…"),storylet("solve7-roxy","A fate resolved","The gunshot rings across the parlor, drowning out all other noise. Blood begins to spread\nacross Mr. Brown's body, soaking into the wall behind him. Your boxer stumbles backwards in\nsurprise, dropping the now-dead Mr. Brown. He flops to the ground like a puppet without\nstrings.\n\nThere's a thump behind you, and you feel the magical pressure return to the room. Turning\naround, you see your wizard knocked out. There's footsteps rushing towars the door, but Roxy\nis already gone. There's just a twinkling of blue light where she once stood.\n\nThe next week is hell for you and your companions. With Mr. Brown dead, the police no longer\nhave an incentive to overlook this case and launch a full investigation. Eventually,\nthough, they have to let you go. Your gun wasn't fired that night, and it doesn't match the\nbullet's caliber anyway. Your partners weren't\npacking. Besides, the idea that a notorious gangland master did the killing isn't a hard sell.\n\nThey dismiss your wild stories about illusory women and broken hearts, though.\nInstead, they pin Roxy\nwith the blame for Mrs. Brown's death as well. If the police ever catch up with her, it'll be\na very bitter day.",{choices:[epilogue]}),storylet("solve7-nobody","A fate resolved","The gunshot rings across the parlor, drowning out all other noise.\n\n\"Curse you, Dis!\" Roxy screams as she knocks you away and takes aim for a second attempt.\n\nBut there's no one to aim at. Behind you, you hear a thump, and you feel the magical\npressure return to the room. Turning\naround, you see your wizard knocked out. For a moment, you see Mr. Brown standing over him,\nbut then there is only a twinkling of blue light.\n\n\"I'll get you, Horace Brown! You can't run from me!\" And moments later, Roxy is gone in a\nsimilar twinkling.\n\nThe police aggressively ignore your attempts to explain the whole incident. With Mr. Brown\npotentially alive, they're still under the gun to keep this secret. You and your\ncompanions are released after a day of cursory interviewing with an unsubtle warning to keep\nyour mouths shut.\n\nIf ther's a silver lining to all this, it's that this is the last you hear of Horace Brown\n_or_ Roxy. Whether she abandoned her post to chase her lover's murderer or she was beaten by\nher quarry, you don't know. But Roxy never returns to lead her gang, and eventually they\nsuccumb to internal\nstrife between those warring for her position. The police get significant portions of her\ngang, and others still are killed in the conflict.\n\nAll told, the city is a little safer.\nFor now.",{choices:[epilogue]}),storylet("solve7-dis","A fate resolved","Two gunshots ring across the parlor. One from Roxy's gun… and one from yours. You couldn't say\nwhich one actually felled Mr. Brown, but he now sports two bleeding wounds that are quickly\nmarring his suit with blood.\n\nYou hear the sound of footsteps rushing outside at the same time as you feel the warpweave\nrush back into the room. Your wizard is so shocked that he's forgotten to do his job. This\nproves to be in your favor, however.\n\nIn a flash of blue light, you suddenly find yourself\non the roof of Roxy's headquarters. She's teleported both of you away from the crime scene.\nThere, she fixes you with a stern glare.\n\n\"What the hell was that, Dis? What did you think you were doing?\"",{choices:[choice("solve8-fordis",'"Mrs. Brown deserved justice."'),choice("solve8-forroxy",'"I didn\'t want to see your hands soiled in this."'),choice("solve8-shoot","Shoot Roxy")]}),storylet("solve8-fordis","A fate resolved",'Roxy laughs. "You still fancy yourself as some kind of hero?" Her gun is\nsuddenly in her hand. "Listen, Dis. That vengeance was mine and mine alone. You don\'t get to\ntake that from me." There is a tense moment before she continues. "So unless you want to end\nup very dead, you are going to agree that I shot him first and then—" She shoves the gun\ntowards you. "_Never_ cross me again. But your did it for Abigail, so this one time, I\'ll let\nyou leave alive."\n\nIt leaves a bitter taste in your mouth, but you consent to her version of events.\nAs you\'re opening the door to the stairs, you hear Roxy say\n"You know, if you want a place to hide out now that you\'re a wanted criminal, my\norganization could use a person like you, Dis."\n\nIt\'s an offer you may have to consider.',{choices:[epilogue]}),storylet("solve8-forroxy","A fate resolved",'Roxy snorts and furrows her brow angrily. "Like my hands aren\'t already bloody. I\'m not some\ndelicate flower for you to protect."\nHer gun is suddenly in her hand. "That\'s not a call you get to make, Dis."\n\nAnd then your world goes black.',{choices:[epilogue]}),storylet("solve8-shoot","A fate resolved","Roxy coughs in surprise and falls to the rooftop.\n\nAt last, every criminal in this case has\nbeen dealt with. Mrs. Brown's murderer is dead, and so is the woman who took Mr. Brown's\nidentity away from him.\n\nSolemnly, you walk over to Roxy's body and take her gun. It's going to take every bullet\nyou have and a fair bit of luck to get out of here alive.\n\nBut at least you can be sure that\njustice, as far as you're concerned, was served today.",{choices:[epilogue]}),storylet("epilogue","Thanks for reading","Thank you for playing **The Disillusionist**, my entry in the 2015 EXPER3 challenge. I hope\nyou enjoyed the experience. Perhaps, if you did not get the ending you wanted or if there are\nleads you haven't followed up on, you may want to hit that reset button in the corner and try\nagain.\n\nWriting this game has been eye-opening for me and a great challenge. I won't pretend it isn't\nwithout its flaws, but I'm proud of it considering it's my first fiction writing in over a\ndecade. If you didn't enjoy the experience, then I apologize, and you can get a full refund of\nyour $0. In fact, I've already sent it to you.\n\nThank you for coming on this journey with me.\n\n—John Bruce, 2015-08-12",{choices:[choice("dummy",void 0,void 0,{visible:{keyOfDreams:reqs.exists}})]})})}.call(this),function(){angular.module("gameDefinition.enums",[]).factory("enums",function(){return{origins:{illusionist:"an illusionist",hallucinist:"a hallucinist",hypnotist:"a hypnotist"},leads:{none:void 0,jackie:"Jackie",employer:"KB&S",cop:"Officer Dentley",student:"Ms. Denotto",roxy:"Roxy"}}})}.call(this),function(){angular.module("gameDefinition.frontChoices",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,front,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,front=qbnEdsl.front,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,front(choice("botherClient","Visit the client","Is there something you need from Mrs. Brown? Or are you just hoping to inspect the scene of\nthe crime?",{active:{bother:function(quality){return quality.value?"You have already bothered Mrs. Brown today. Try again tomorrow.":!0}}})),front(choice("straightTrades","Do odd jobs","Sure, you're working for Mrs. Brown, but doing that takes resources. Resources you'll have\nto earn some other way.")),front(choice("storylines","Track down a lead","You know a few places to start looking for info.",{visible:{lead:reqs.notexists}})),front(choice("jackie","Search for Jackie's missing partner",'She left for "greener pastures."',{visible:{lead:reqs.eq(leads.jackie)},next:function(jackie){switch(jackie){case 2:return"jackie1"}}})),front(choice("employer","Headhunt for KB&S","They have some very specific needs.",{visible:{lead:reqs.eq(leads.employer)},next:function(kbs){switch(kbs){case 1:return"employer1"}}})),front(choice("cop","Follow up on Dentley's tip","He said you'd want to see this.",{visible:{lead:reqs.eq(leads.cop)},next:function(cop){switch(cop){case 1:return"cop1"}}})),front(choice("student","Research the seasonal symposium","Ms. Denotto needs to know about her competition and the judges.",{visible:{lead:reqs.eq(leads.student)},next:function(student){switch(student){case 1:return"student1"}}})),front(choice("roxy","Pursue Roxy the gangster","She wants Mrs. Brown out of town. But why?",{visible:{lead:reqs.eq(leads.roxy)},next:function(roxy){switch(roxy){case 2:return"roxy1"}}})),front(choice("dealerFront","Visit the Rarities Dealer","Perhaps you have something he'd like to trade.",{visible:{dealer:reqs.gte(1)}})),front(choice("rest","Return home to rest","It's been a long day. Perhaps it's time to go back to your apartment and get some shuteye.\n\n_This will advance the day by one and reset your hunches._"))})}.call(this),function(){angular.module("gameDefinition.introStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var beginChoice,beginSnippet,choice,consq,origins,reqs,start,storylet;storylet=qbnEdsl.storylet,start=qbnEdsl.start,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,origins=enums.origins,start("lets-begin"),storylet("lets-begin","It was a dark and stormy decade…","The years that followed the commoditization of sorcery were tumultous and difficult. People\nwere faced with an ever-expanding array of new possibilities for their lives. The social\norder was shaken like an uptown Old Fashioned.\n\nThere was, naturally, a war. You came out of it with a few interesting scars to share with\nthose most intimate and one very uninteresting scar on your psyche that left you permanently\nunable to access the sorceric warpweave ever again. It was a shame, too. You'd had such a\npromising career before that, studying…\n\nWhich branch of magic was it again?",{choices:[choice("begin-illusion","Illusion","The magic of making one thing appear to be another thing."),choice("begin-hallucination","Hallucination","The magic of making things appear to exist which do not."),choice("begin-hypnotism","Hypnotism","The magic of making people believe things they do not.")]}),beginSnippet="Yes, that was it.\n\nAnyway, that's all over now. The war left you without a scrap of magic\nto your name, just a strange itch whenever you're in the presence of your old field of work.\n\nBut you, you were enterprising. You parleyed that subliminal itch, that instinct about magic,\ninto a career as a detective. When people have problems that seem magical in nature, they come\nto you. You are The Disillusionist.",beginChoice=choice("begin-case","Tell me about my latest case"),storylet("begin-illusion","Ah, Illusion",beginSnippet,{consequences:{origin:consq.set(origins.illusionist),illusionHunch:consq.increase(1)},choices:[beginChoice]}),storylet("begin-hallucination","Ah, Hallucination",beginSnippet,{consequences:{origin:consq.set(origins.hallucinist),hallucinationHunch:consq.increase(1)},choices:[beginChoice]}),storylet("begin-hypnotism","Ah, Hypnotism",beginSnippet,{consequences:{origin:consq.set(origins.hypnotist),hypnotismHunch:consq.increase(1)},choices:[beginChoice]}),storylet("begin-case","It was late on a Tuesday…","It was late on a Tuesday when Mrs. Abigail Brown walked into your office. Normally, when a\nlady that well-dressed sees fit to cross your door, there's infidelity behind it. It means\nlong nights staking out a love nest in your future, waiting for Mr. Client to come dally with\nNot-Mrs. Client.\n\nBut something was off. This wasn't the usual cheating-husband job. There was a tear to her\neye before she even\ngot in your door, not the mixture of determination and shame that eventually gave way to\neither sobbing or rage.\n\nOver the next forty-five minutes, you drew the whole story out of her. How she was the wife\nof famed sorcerer Horace Brown. How he had gone missing two weeks ago from a sealed parlor\nin their Silver Street home. How the police had dismissed the case with suspicious ease,\ninsisting Mr.\nBrown must have simply had an accident with forces beyond his control. As if \"Demon Eyes\nBrown\" had ever met a force he could not match.\n\nYou took the case in a heartbeat. This was not only the most interesting case to cross your\ndesk since there was snow on the ground, but it stood to be the most lucrative in a long time,\nand the landlord was starting to resemble a hungry wolf more and more each day. Mrs. Brown\npaid the retainer for your first two days and didn't even haggle the rate.\n\nNow the only question was: Where to start looking?",{consequences:{bluebacks:consq.increase(2)},choices:[choice("returnForward","The story continues…","_Go to the main screen._",{next:!1})]})})}.call(this),function(){angular.module("gameDefinition.jackieStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("jackieStart","Jackie, old-school detective","Jackie is in his office when you find him. It's never a good sign if Jackie is in his\noffice. It means he's too out of work to be busy and too despondent to be drinking. Judging\nby his state, times are even tougher than you thought.\n\n\"Oh god, it's you,\" he mutters as you enter. \"And to what do I owe the pleasure of the great\nDisillusionist's presence?\"\n\nYou explain about Horace Brown.\n\n\"What? Is that all? You know what I'm going to say. Same thing you would if I came to you,\nDis. 'Screw off!' What kind of detective would I be if I didn't respect my clients'\nconfidentiality? People come here for all sorts of private stuff. I'd be out of work in no\ntime if I started spilling their beans.\"\n\nYou suppress the urge to argue that, point of fact, it doesn't look like anyone has been\ncoming here for _any_ sort of stuff lately. Instead, you appeal to the point that Mr. Brown\nis missing, possibly dead, and this could help lead to his rescue.\n\n\"That just makes it worse. If he's dead, he can't tell anyone whether he'd give a damn about\nmy secrecy, can he? Get lost, pal. These lips are sealed.\"",{choices:[choice("bribeJackie","Try to bribe him","Jackie looks like he could use the money, and principles won't pay the rent.",{active:{bluebacks:reqs.gte(6)}}),choice("dontBribeJackie","Get lost","Looks like this is a dead end.",{next:!1})]}),storylet("bribeJackie","Try to bribe him","For a long moment, Jackie hungrily eyes the bills in your hand. But just when you think he's\ngoing to take your offer—\n\n\"Put that away.\" He slumps in his chair. \"This is really that important to you, huh?\"\n\nHe eyes the empty desk on the opposite side of the room. \"She's gone. Did you even notice?\"\nCome to think of it, where _is_ his partner? \"Just up and stormed out a few weeks ago. Said\nshe had to seek 'greener pastures,' whatever that means.\n\n\"I'm nothing without her, Dis. I may be the sandpaper skin and muscle of this team, but she\nwas the brains. This outfit was on hard times before, but it's falling apart without her.\n\n\"I've tried to find her, but she's fallen off the map so well, I can't even get a whiff of\nher. But then, she knows all my techniques; she's better-qualified than anyone to avoid me.\nBut you! You, she isn't so well-equipped to avoid. Find her for me, and I'll forget about\ndetective-client confidentiality for a bit as regards the quite-likely-late Mr. Brown and his\nconcerns.\"",{consequences:{lead:consq.set(leads.jackie),jackie:function(quality){return quality.value++,"Jackie has asked you to find his partner."},progress:consq.set(0)}}),storylet("jackie1","Search for Jackie's missing partner","She's gone to ground, or maybe left the city entirely. You need to pick up her trail.",{choices:[choice("jackie1Rumor","Hit the streets","Ask around. Try not to be too obvious. Someone must have seen _something_.",{visible:{progress:reqs.lt(5)},active:{rumor:reqs.gte(3)}}),choice("jackie1Hunch","See if you get any hunches","She wasn't a mage, but then, neither is Jackie. Maybe she's using magic to cover her\ntracks from him.",{visible:{progress:reqs.lt(5)},active:{hallucinationHunch:reqs.gte(1)}}),choice("jackie1Solve","Aha!","You've pieced together enough to find her!",{active:{progress:reqs.gte(5)}})]}),storylet("jackie1Rumor","Hit the streets","You don't get any info on her directly, but the omissions in the stories are almost as\ntelling as the stories themselves.",{consequences:{rumor:consq.decrease(3),progress:consq.increase(1)}}),storylet("jackie1Hunch","See if you get any hunches","There's traces of it all over the building where Jackie's office is. Little scraps of\nstore-bought hallucinations, nothing elaborate. But telltale signs that she's been trying\nto keep him off her trail.",{consequences:{hallucinationHunch:consq.decrease(1),progress:consq.increase(1)}}),storylet("jackie1Solve","Out of the city, but not far","It looks like she's left the city, but she didn't go far. Makes sense; someone had to keep\nthose glamours up, and if she trusted anyone else, it'd be a liability. You catch up with her\nat a library. She doesn't remember you, but when you mention who you're working for, she\ndrags you into an empty reading room and shuts the door.\n\n\"Dammit,\" she starts. \"I can't believe Jackie hired another gumshoe to hunt me down. Is he\nreally that desperate to have me back?\"\n\nYou lay out the situation. You explain how Jackie seemed to be falling apart. She snorts.\n\n\"That wasn't me leaving that did that. That stuff was why I left. Jackie's been on the long\ndownward slide for years now. Couldn't wrap his thick skull around this new world we all live\nin. Magic befuddles him more than if someone just cast some befuddling magic at him.\"\n\nShe purses her lips and concentrates on an empty corner of the room. \"It's not the paucity of\njobs I minded, really. Times were always lean. The problem is—\" A long pause.\n\n\"He got desperate for work. Started taking hit jobs for the mob. I won't be involved in that\nkind of work again. He knew that, tried to keep it secret from me, but when I found out, I\nknew it had to be over.\" She sets you with a hard stare. \"Don't tell Jackie where I am, Dis.\nIt's a complication I\ndon't want to deal with, and really, neither does he. I just want to put that past behind me.\"\n\nShe fishes around in her bag for a moment. \"I don't have any info on the Brown\ndisappearance to offer you, but I know the fuel you operate on. Hunches, right? I'm trying\nto get better acquainted with the magical world. I picked this thing up from a travelling\nsalesman. Helps with detecting hallucinations. If you go back and tell Jackie that you\ncouldn't find me, it's all yours.\"",{choices:[choice("jackieFinalJackie","Tell Jackie the truth","Honesty is always the best policy, and you need the info on Mr. Brown."),choice("jackieFinalPartner","Take her offer","This is messy and not your responsibility. Plus, that trinket could pay dividends in the\nBrown case and for years to come.")]}),storylet("jackieFinalJackie","Honesty is always the best policy","You leave her screaming obscenities after you as you leave. If she's smart, she'll be packing\nup and covering her trail again before Jackie arrives.\n\nYou drive straight to Jackie's and spill the beans. He almost runs out before he has time to\npay up. You drag him back to reality and he hurriedly dumps a huge file on your lap before\nushering you out and racing towards the suburb where a very awkward shouting match awaits.\n\nThe file explains that Mr. Brown's concerns were as old as time, the bread and butter of the\nsleuthing trade: He thought his wife was cheating on him. Jackie had been gathering photos and\ninfo for two weeks before Mr. Brown disappeared and the whole file became worthless. And\njudging by the contents, Mr. Brown was right to be worried. Mrs. Brown apparently has some\nvery specific interests that were going very unfulfilled by Mr. Brown. Could she be more\ninvolved than she's letting on? Or, alternatively, could one of the other people pictured be\nbehind this?",{consequences:{evidence:consq.increase(1),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},jackie:function(quality){return quality.value=3,"You found Jackie's partner for him."},progress:consq.set(0)}}),storylet("jackieFinalPartner","Take Her Offer","You accept the trinket. It's a small figurine — sealbone, if you're any judge — carved in the\nshape of some north sea deity you don't recognize. Jackie's partner seems pleased at your\nacceptance, but she still shoots you a warning glare before departing the library. It's the\nlast you ever see of her.\n\nJackie is crestfallen but unsurprised to hear of your failure. He seems to sink further into\nhis chair as you close the door behind you on the way out. He wouldn't hear of your advice\nto try and adapt to this new world. \"Fat lot of good it did you in finding my partner, Dis.\"",{consequences:{sealboneTrinket:consq.increase(1),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},jackie:function(quality){return quality.value=4,"You did not tell Jackie where his partner is."},progress:consq.set(0)}})})}.call(this),function(){angular.module("gameDefinition.leadStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("storylines","Track down a lead","You sit down at your desk and pool all your possible leads. Someone out there has to\nknow something about what happened. The question is: Who?\n\n_If you successfully start a lead, you will be committed to that lead and unable to follow up\nany others until you see your current lead through._",{choices:[choice("jackieStart","Jackie, old-school detective","Mr. Brown hired Jackie to do something. What? And why?",{visible:{jackie:reqs.eq(1)}}),choice("roxyStart","Roxy Malone, big-time gangster","Roxy is trying to intimidate Mrs. Brown. But why?",{visible:{roxy:reqs.eq(1)}}),choice("employerStart","Mr. Brown's last employer","Mr. Brown was doing work for hire for the offices of Kimble, Battherwhite, and Smith when\nhe disappeared.\nSomeone there might know something.",{visible:{kbs:reqs.eq(0)},active:{rumor:reqs.gte(10)}}),choice("pressStart","The press","The disappearance of someone as high-profile as Horace Brown should be all over the news.\nBut Mrs. Brown was the first you heard of it. Who's keeping the papers quiet? Maybe one\nof your contacts knows.",{visible:{keyOfDreams:reqs.exists}}),choice("copStart","A crooked cop","Officer Dentley is a lousy cop, but a great informant. For the right fee, he'll tell you\neverything the police know about anything.",{visible:{cop:reqs.eq(0)},active:{bluebacks:reqs.gte(10)}}),choice("clubEntry","The Salamander Club","Ever since you lost your magical abilities, you've lost touch with the magical community\nin the city.\nThe Salamander Club is a favorite watering hole of the sorcerous set and your best bet to\nmake contact with anyone who might know Mr. Brown.",{active:{cantripUp:reqs.gte(6)}})]}),storylet("clubEntry","The Salamander Club","Downing an entire case of Cantrip-Up won't restore your magic in any way, but it will give you\nenough of a glow to trick the bouncer into letting you in.\n\nOnce inside, you take up a position in the corner closest to the kitchen and watch the\ncrowd. There are countless magical types in here, but do any catch your eye?",{consequences:{cantripUp:consq.decrease(6)},choices:[choice("clubStudent","A nervous-looking student","She looks liable to explode at any second. Whether literally or figuratively, you're not\nsure.",{visible:{student:reqs.eq(0)}}),choice("clubDealer","A dealer in rarities","He's doing a brisk trade from his booth.",{visible:{dealer:reqs.notexists},active:{cagedDemon:reqs.gte(1)}}),choice("clubQuit","Cut your losses","This sounded like a better plan before you drank all that Cantrip-Up.\n\n_This will allow you to leave and restore some, but not all, of the resources you expended\nto get in here._")]}),storylet("clubQuit","Cut your losses","You slip through the kitchen on your way out and grab a nearly-full case of Cantrip-Up.\nThey probably won't miss it.",{consequences:{cantripUp:consq.increase(5)}})})}.call(this),function(){angular.module("gameDefinition",["qbn.edsl","gameDefinition.qualities","gameDefinition.frontChoices","gameDefinition.introStories","gameDefinition.restStories","gameDefinition.straightTradeStories","gameDefinition.clientStories","gameDefinition.leadStories","gameDefinition.jackieStories","gameDefinition.employerStories","gameDefinition.copStories","gameDefinition.studentStories","gameDefinition.dealerStories","gameDefinition.roxyStories","gameDefinition.endingStories"]).run(function(qbnEdsl){var choice,onwards,retreat;choice=qbnEdsl.choice,retreat=qbnEdsl.retreat,onwards=qbnEdsl.onwards,retreat(choice("retreat","On second thought, maybe not…","_Return to the main screen._",{next:!1})),onwards(choice("onwards","The story continues…","_Return to the main screen._",{next:!1}))})}.call(this),function(){}.call(this),function(){angular.module("gameDefinition.qualities",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var leads,origins,quality,qualityType;quality=qbnEdsl.quality,qualityType=qbnEdsl.qualityType,origins=enums.origins,leads=enums.leads,quality("keyOfDreams",qualityType.item,"Key of Dreams","An item that does not exist yet is necessary to access unimplemented content.",{value:0}),quality("day",function(){
return"Day "+this.value+" of the Investigation"},"Day",void 0,{value:1}),quality("lead",function(){return"Current Lead: "+this.value},"Your current lead",void 0,{value:leads.none}),quality("progress",function(){return"Lead Progress: "+this.value},"Your progress on your lead",void 0,{value:0}),quality("illusionHunch",qualityType.item,"Illusion Hunch","Used to see the true form of things.",{value:1}),quality("hallucinationHunch",qualityType.item,"Hallucination Hunch","Used to spot nonexistant things.",{value:1}),quality("hypnotismHunch",qualityType.item,"Hypnotism Hunch","Used to notice when others are being controlled.",{value:1}),quality("evidence",qualityType.item,"Evidence","Gather enough of this to solve the case!"),quality("bluebacks",qualityType.item,"Bluebacks","Magical counterfeit-proof bills. They're actually more of an iridescent black."),quality("cantripUp",qualityType.item,"Cantrip-Up","The beverage of mages. Contains concentrated warpweft that mildly enhances magical powers.",{value:1}),quality("rumor",qualityType.item,"Rumor","Good, old-fashioned gossip. Juicy secrets that lose their value once spread."),quality("cagedDemon",qualityType.item,"Caged Demon","Demonology is illegal, but harvesting these from old battlefields is a public service."),quality("jackie",function(){switch(this.value){case 1:return"Mr. Brown hired a private eye before his disappearance";case 2:return"Jackie has asked you to find his partner";case 3:return"You found Jackie's partner for him";case 4:return"You found Jackie's partner but decided to keep it quiet"}},"!!ERROR!!",void 0),quality("kbs",function(){switch(this.value){case 1:return"You are headhunting for KB&S";case 2:return"You found an ecclectic crew for KB&S"}},"!!ERROR!!",void 0),quality("cop",function(){switch(this.value){case 1:return"You are searching for a body";case 2:return"You found a body, but whose?"}},"!!ERROR!!",void 0),quality("student",function(){switch(this.value){case 1:return"You are helping a student survive";case 2:return"You helped a student survive the seasonal symposium"}},"!!ERROR!!",void 0),quality("roxy",function(){switch(this.value){case 1:return"Roxy Malone wants Mrs. Brown out of town";case 2:return"You've narrowed down the places Roxy could be";case 3:return"You stole some letters from Roxy's hideout";case 4:return"You stole a ribbon from Roxy's hideout"}},"!!ERROR!!",void 0),quality("bother",function(){return"You have already bothered your client today"},"Bother"),quality("advance",function(){return"You have gotten an advance on your payment"},"Advance"),quality("dealer",qualityType.item,"Dealer Card","It gives an address and a password to contact the Rarities Dealer with."),quality("origin",function(){return"You were "+this.value},"Origin",function(origin){switch(origin){case origins.illusionist:return"Gives you 1 more Illusion Hunch each day.";case origins.hallucinist:return"Gives you 1 more Hallucination Hunch each day.";case origins.hypnotist:return"Gives you 1 more Hypnotism Hunch each day."}}),quality("inscribedRibbon",qualityType.item,"Inscribed Ribbon","Gives you 1 more Illusion Hunch each day."),quality("sealboneTrinket",qualityType.item,"Sealbone Trinket","Gives you 1 more Hallucination Hunch each day."),quality("veinyCarnelian",qualityType.item,"Veiny Carnelian","Gives you 1 more Hypnotism Hunch each day.")})}.call(this),function(){angular.module("gameDefinition.restStories",["qbn.edsl","gameDefinition.enums","qbn.quality"]).run(function(qbnEdsl,enums,qualities){var choice,consq,origins,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,origins=enums.origins,storylet("rest","Return home to rest","It's been a long day. Perhaps it's time to go back to your apartment and get some shuteye.",{choices:[choice("endOfDay",function(day){return"End day "+day+" of the investigation"},"_This will advance the day by one and reset your hunches._")]}),storylet("endOfDay","You sleep the sleep of the employed-per-diem-plus-expenses",void 0,{consequences:{illusionHunch:function(quality){var hunches,i,ref;for(hunches=1,qualities.lookup("origin").value===origins.illusionist&&hunches++,i=0,ref=qualities.lookup("inscribedRibbon").value;ref>=0?ref>i:i>ref;ref>=0?i++:i--)hunches++;return quality.value=hunches,"You now have **"+hunches+"** Illusion Hunches."},hallucinationHunch:function(quality){var hunches,i,ref;for(hunches=1,qualities.lookup("origin").value===origins.hallucinist&&hunches++,i=0,ref=qualities.lookup("sealboneTrinket").value;ref>=0?ref>i:i>ref;ref>=0?i++:i--)hunches++;return quality.value=hunches,"You now have **"+hunches+"** Hallucination Hunches."},hypnotismHunch:function(quality){var hunches,i,ref;for(hunches=1,qualities.lookup("origin").value===origins.hypnotist&&hunches++,i=0,ref=qualities.lookup("veinyCarnelian").value;ref>=0?ref>i:i>ref;ref>=0?i++:i--)hunches++;return quality.value=hunches,"You now have **"+hunches+"** Hypnotism Hunches."},bother:function(quality){return quality.value?(quality.value=!1,"It's a new day, and your client is again willing to see you."):void 0},day:consq.increase(1)}})})}.call(this),function(){angular.module("gameDefinition.roxyStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("roxyStart","Roxy Malone, big-time gangster","There are three big gangs in the city. North of the river belongs to Mac Turleigh's boys.\nThe financial district is under the watchful eye of Ambrose Beard. And everything else?\nEverything else belongs to Roxy Malone's gang.\n\nRoxy appeared during the war, already leading a small gang of street toughs. While the old\ngangs had their eyes turned to war profiteering, she was qietly eating away at their\nterritory back home. While the old gangs were trying to understand how to get mages to work\nfor them, she was already an accomplished sorceress in her own right. Roxy was a native of\nthe new world. And one by one, the old gangs fell before her or joined her outright. Smart\nmoney says she won't rest until she owns the whole city.\n\nSo why is she concerning herself with Mrs. Brown? What does she have to gain from driving a\ngrieving woman from her home? There's more going on here than meets the eye.\n\nThis won't be the first time you two have crossed paths, but you don't know where she's\noperating out of these days. You'll need to get a bead on Roxy before you can confront her.",{choices:[choice("findRoxy","Begin searching for her","You're going to need to do some investigation just to find a place to start looking.",{active:{rumor:reqs.gte(6)}}),choice("dontFindRoxy","No good","Roxy is still giving you the slip.",{next:!1})]}),storylet("findRoxy","Begin searching for her","There's a through-line to the stories on the street about Roxy's gang. For the last six\nmonths, they've been having\ntrouble bringing enough people to bear to pressure the other gangs. And they're more focused\non consolidating power in the magic districts. It all adds up to one thing: Roxy must have\nmoved her base of operations east, away from downtown… and right into the vicinity of\nthe Brown mansion.\n\nBased on shakedown rates in various districts, you figure Roxy's hideout must be somewhere\nwithin an area of about fifteen blocks on the east end. It's still a wide area, but it's a\nstart.",{consequences:{lead:consq.set(leads.roxy),roxy:function(quality){return quality.value++,"You know where to start looking for Roxy"},progress:consq.set(0)}}),storylet("roxy1","Pursue Roxy the gangster","No operation as large as Roxy's can avoid leaving a trail behind.",{choices:[choice("roxy1Bluebacks","Pay off low-level scum","The lowest man on the totem pole is usually the most willing to trade money for secrets.",{visible:{progress:reqs.lt(5)},active:{bluebacks:reqs.gte(3)}}),choice("roxy1Hunch","Look for unusual illusions","A wizard like Roxy is bound to be using huge numbers of illusions to cover up her\noperations.",{visible:{progress:reqs.lt(5)},active:{illusionHunch:reqs.gte(1)}}),choice("roxy1Solve","Aha!","You've pieced together enough to find her!",{active:{progress:reqs.gte(5)}})]}),storylet("roxy1Bluebacks","Pay off low-level scum","None of them have been to the headquarters directly. Most of them are at least two tiers\nremoved from anyone important enough to know anything. But who they meet and where they meet\nthem tells you a lot about who to pay off next and where the orders are coming from.",{consequences:{bluebacks:consq.decrease(3),progress:consq.increase(1)}}),storylet("roxy1Hunch","Look for unusual illusions","There are illusions all over this part of town, of course. When using a spell to spruce up\nyour home is so easy, why not do it? Still, a few places with an unusual number and specificty\nof illusions catch your eye, particularly the ones with illusions in places that have nothing\nto do with decor.",{consequences:{illusionHunch:consq.decrease(1),progress:consq.increase(1)}}),storylet("roxy1Solve","In a disused print shop","The print shop's shell only takes up a small portion of the first floor, but it's been\nmagicked to appear larger than it is, to cover up the fact that the rest of the building is\nfilled with gangsters.\n\nRoxy won't deign to see you if you just walk up to the front door. Not after what happened\nlast time. So it looks like breaking and entering is your only option. You slip in a back door\nand slide through a hallucinatory wall. You're upstairs and rifling through files without\nanyone being the wiser. Their contents aren't very revealing, though. Nothing in here really\nexplains the link to Mr. Brown.\n\nYou've just spotted a locked cabinet in the corner and are considering how to best open it\nwhen a lowly runner wanders in and spots you. He rushes out and sounds the alarm. Cursing your\nluck, you shoot the lock off. Inside is a stack of envelopes and a small, magical charm.\n\nYou're going to need a hand free to hold your gun. Which do you take?",{choices:[choice("roxyFinalLetters","Take the letters","They smell… nice?"),choice("roxyFinalRibbon","Take the spell-inscribed ribbon","You've seen these before. They're used to overcome illusions.")]}),storylet("roxyFinalLetters","Mysterious letters","Once safely back in your office, you peruse the letters with great curiosity. They appear to\nbe love letters. You have no idea who this Joy person is, nor who she was writing to, but\nthe smell of perfume on them is tugging at your memory, as if you've smelled it before. And\nwhoever she is, she uses the post office near Mr. Brown's mansion.",{consequences:{evidence:consq.increase(1),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},roxy:function(quality){return quality.value=3,"You stole some letters from Roxy Malone's hideout."},progress:consq.set(0)}}),storylet("roxyFinalRibbon","A magic ribbon","Once safely back in your office, you confirm what you already suspected. The ribbon is a charm\nagainst illusions, inscribed with a spell of protection. It isn't the evidence in the case\nthat you were looking for, but it should be very useful in continuing your investigation.",{consequences:{inscribedRibbon:consq.increase(1),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},roxy:function(quality){return quality.value=4,"You stole a ribbon from Roxy Malone's hideout."},progress:consq.set(0)}})})}.call(this),function(){angular.module("gameDefinition.straightTradeStories",["qbn.edsl"]).run(function(qbnEdsl){var choice,consq,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,storylet("straightTrades","Odd jobs","There's always work to be had for someone with your particular talents. It's not always\n_good_ work, but it pays.\n\nOf course, it takes money to make money. Or in your case, it takes hunches. If you're all\ntapped out, you may just have to come back tomorrow.",{choices:[choice("warehouseStraight","Find warehouse cover-ups","Search warehouses for faked shipments.",{active:{illusionHunch:reqs.gte(1)}}),choice("partyStraight","Clean up after a party","The students from the Department of Illusory Arts don't just throw regular parties.",{active:{illusionHunch:reqs.gte(1)}}),choice("antiqueStraight","Filter an antiquarian's collection","Unscrupulous types often sell fake antiques to unsuspecting shops.",{active:{hallucinationHunch:reqs.gte(1)}}),choice("beatWalkStraight","Search for public menaces","Walk a police beat looking for hallucinatory graffiti.",{active:{hallucinationHunch:reqs.gte(1)}}),choice("dealsStraight","Notarize business deals","It's important to make sure no one signing a contract is under an enchantment.",{active:{hypnotismHunch:reqs.gte(1)}}),choice("securityStraight","Provide building security","Check each employee before they enter to make sure they haven't been compromised.",{active:{hypnotismHunch:reqs.gte(1)}})]}),storylet("warehouseStraight","Find warehouse cover-ups","You spend a few hours pointing out crates that have been magically modified and bills of\nlading that have been magically forged. The foreman can't afford to pay you, but you wave\nhim off. You got more than your money's worth in gossip from the dockworkers.",{consequences:{illusionHunch:consq.decrease(1),rumor:consq.increase(2)}}),storylet("partyStraight","Clean up after a party","Along with moving furniture, you helpfully point out which objects have been carelessly\ntransmuted or obscured. With any luck, the landlord will never realize how much this place\nresembled a magical strip club in a junk heap this morning. Being poor students, they can only\npay in leftovers from last night, but it's worth the effort.",{consequences:{illusionHunch:consq.decrease(1),cantripUp:consq.increase(2)}}),storylet("antiqueStraight","Filter an antiquarian's collection",'You gently break the news. This one is fake. That one is real. The large one in the back? It\nnever existed at all. The antiquarian, forseeing lean times in his future, can only offer a\n"mage\'s wages."',{consequences:{hallucinationHunch:consq.decrease(1),cantripUp:consq.increase(2)}}),storylet("beatWalkStraight","Search for public menaces","You find the work of a few overnight vandals, including some really impressive choreographed\ndragons and flamingos in the theater district. Maybe someone was trying to audition to do\nspecial effects?\n\nThe police pay you duly for your help.",{consequences:{hallucinationHunch:consq.decrease(1),bluebacks:consq.increase(2)}}),storylet("dealsStraight","Notarize business deals","It's the dryest possible work, just sitting there watching all parties in a negotiation\nto make sure there's no funny business going on. There isn't, of course, but the reassurance\nof your presence is essential. And you pick up plentiful info from the deals you overhear.",{consequences:{hypnotismHunch:consq.decrease(1),rumor:consq.increase(2)}}),storylet("securityStraight","Provide building security","Most people pass muster, but you do have to stop a few for additional investigation. One\nappears to be genuinely unaware of her predicament and is sent off for disenchanting. Another\nis apparently into some very unorthodox uses of spellwork in the bedroom and\nforgot to clean everything off himself afterwards. He is likewise sent off for disenchanting.\n…and a bath.",{consequences:{hypnotismHunch:consq.decrease(1),bluebacks:consq.increase(2)}})})}.call(this),function(){angular.module("gameDefinition.studentStories",["qbn.edsl","gameDefinition.enums"]).run(function(qbnEdsl,enums){var choice,consq,finalText,leads,reqs,storylet;storylet=qbnEdsl.storylet,choice=qbnEdsl.choice,reqs=qbnEdsl.reqs,consq=qbnEdsl.consq,leads=enums.leads,storylet("clubStudent","A nervous-looking student",'If they ever throw a rocking chair convention for cats and provide free coffe, it might begin\nto equal this young lady\'s level of nerves. You make sure to approach from the front, where\nshe can see you.\n\n"What do you want?" she hisses as you slide into the chair opposite.\n\nYou explain yourself.\n\n"Oh— Oh really? Hey, you might be able to help me! My name\'s Amber Denotto." She shakes your\nhand. "I\'m one of Mr. Brown\'s students. Or _was_, if the rumors are to be believed. It\'s\nenough for the university, anyway. They want to reassign me to a new mentor, and that means\ngiving up the research materials Mr. Brown provided to me."\n\n"I\'d be willing to part with them to you instead, though. Just… a little tit-for-tat, you\nknow? I need your help with something first."\n\nYou pointedly continue listening silently.\n\n"The seasonal symposium is coming up soon. If I get reassigned and have to start my project\nover, there\'s no way I stand a chance of placing for a prize, which means no chance of keeping\nmy scholarship. Unless… Unless I had some way\nof knowing what competition I\'m up against. If I could tailor my new project to the judges\nand make sure it stands out from the competition, I should at least be able to get an\nhonorable mention."\n\n"Do that, and my old project materials from Mr. Brown are yours."',{consequences:{lead:consq.set(leads.student),student:function(quality){return quality.value++,"You are helping a student survive the seasonal symposium"},progress:consq.set(0)}}),storylet("student1","Research the seasonal symposium","Information is everywhere at the university. The question is, where to start?",{choices:[choice("student1Illusion","Research illusions","Search the illusion department for information.",{visible:{progress:reqs.lt(7)},active:{illusionHunch:reqs.gte(1)}}),choice("student1Hallucination","Research hallucinations","Speak with the Dean of Hallucinations.",{visible:{progress:reqs.lt(7)},active:{hallucinationHunch:reqs.gte(1)}}),choice("student1Hypnotism","Research hypnotisms","As you recall from your own university days, using hypnotism to cheat is practically\nmandatory.",{visible:{progress:reqs.lt(7)},active:{hypnotismHunch:reqs.gte(1)}}),choice("student1Solve","That should be enough","You have enough info to give Ms. Denotto a decided edge.",{active:{progress:reqs.gte(7)}})]}),storylet("student1Illusion","Research illusions","You find several groups of students who are preparing illusion presentations for the\nsymposium, including one presentation that is actually illusory. They might want to work on\nthat further.",{consequences:{illusionHunch:consq.decrease(1),progress:consq.increase(1)}}),storylet("student1Hallucination","Research hallucinations","The dean is tight-lipped at first, but you demonstrate appreciation for some of the finer\nhallucinations scattering his office and he begins to warm up and talk about who will be\nfeaturing at this year's symposium.",{consequences:{hallucinationHunch:consq.decrease(1),progress:consq.increase(1)}}),storylet("student1Hypnotism","Research hypnotisms","Sure enough, several students are already preparing their hypnotisms to try and trick the\njudges. It was probably never going to work, but turning them in reduces Ms. Denotto's\ncompetition and gets you brownie points with people who can leak details of the symposium.",{consequences:{hypnotismHunch:consq.decrease(1),progress:consq.increase(1)}}),storylet("student1Solve","Hope springs eternal",'Ms. Denotto seems very pleased with the results you deliver. She\'s practically licking her\nlips with excitement at her prospects. "With this much, I could probably even _place_ at\nthe symposium. I should have hired you years ago!"\n\nShe\'s all too happy to part with her old research materials. You are shocked to discover that\nMr. Brown provided her with a live demon in a cage. The things are exceedingly rare, and just\nseeing the little fiend\'s golden compound eyes takes your mind back to times better left\nforgotten.\n\nMs. Denotto misinterprets your reverie as concern. "Don\'t worry, this is\ntotally legal. Here—" She hands you a sheaf of papers. "These papers prove that he\'s\nlegitimate, culled from the old battlefields and not some demonologist\'s weekend mistake."\n\nThe other materials are nothing so interesting. Indeed, you\'ll probably just hock them later.\nBut as she reaches to hand over the last packet, Amber stops. "Can I— Can I keep just one\nthing? To remember him by. Mr. Brown was actually quite good as a mentor."\n\nShe opens the packet to reveal two tiny objects. "Go ahead, take either one you like. Just\nleave the other one for me."',{choices:[choice("studentFinalSealbone","Take the sealbone figurine","Sealbone carvings like this are often sensitive to hallucinations."),choice("studentFinalRibbon","Take the inscribed ribbon","The inscriptions are supposed to protect the bearer against illusions.")]}),finalText="Amber nods and closes the packet. \"If you ever change your mind, I bet the dealer in the\nSalamader Club could help you. He's always helping students swap things we've been\noverallocated for things we can't get.\"",storylet("studentFinalSealbone","A sealbone figurine",finalText,{consequences:{cagedDemon:consq.increase(1),bluebacks:consq.increase(3),sealboneTrinket:consq.increase(1),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},student:function(quality){return quality.value++,"Your help has been invaluable to Ms. Denotto"},progress:consq.set(0)}}),storylet("studentFinalRibbon","An inscribed ribbon",finalText,{consequences:{cagedDemon:consq.increase(1),bluebacks:consq.increase(3),inscribedRibbon:consq.increase(1),lead:function(quality){return quality.value=void 0,"Your current lead has ended."},student:function(quality){return quality.value++,"Your help has been invaluable to Ms. Denotto"},progress:consq.set(0)}})})}.call(this);